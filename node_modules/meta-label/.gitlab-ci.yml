stages:
  - build
  - deploy

build:yarn:
  stage: build
  image: node:alpine
  script:
    - yarn
    - yarn build
  artifacts:
    paths:
      - dist/
    expire_in: 1 week
  cache:
    paths:
      - node_modules
  only:
    - master
  tags:
    - docker
    - yarn
    - deploy

deploy:registry:
  stage: deploy
  image: node:alpine
  script:
    - echo $NPMJS_REGISTRY_TOKEN > .npmrc
    - npm publish 
  cache:
    paths:
      - node_modules/
    policy: pull
  dependencies:
    - build:yarn
  only:
    - master
  tags:
    - yarn
    - deploy
    - docker